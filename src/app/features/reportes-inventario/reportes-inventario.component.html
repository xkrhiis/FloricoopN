<div class="container-fluid py-4">

  <!-- Encabezado -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 font-weight-bold mb-1" style="color:#4b0082">
        Reportes de Inventario
      </h1>
      <p class="text-muted mb-0">
        Resumen visual del inventario y generación de reporte en PDF
        basado en los datos actuales de <code>/api/productos</code>.
      </p>
    </div>

    <button
      type="button"
      class="btn btn-outline-primary"
      (click)="descargarPdf()"
      [disabled]="cargando || !productos.length"
    >
      <i class="fas fa-file-download mr-2"></i>
      Descargar reporte PDF
    </button>
  </div>

  <!-- Estado de carga / error -->
  <div *ngIf="cargando" class="p-3 text-center text-muted">
    <span class="mr-2"><i class="fas fa-circle-notch fa-spin"></i></span>
    Cargando datos de inventario...
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Contenido principal cuando hay datos -->
  <ng-container *ngIf="!cargando && productos.length">

    <!-- Resumen -->
    <div class="row mb-4">
      <div class="col-md-3 mb-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <div class="text-muted small mb-1">Total de productos</div>
            <div class="h3 mb-0">{{ totalProductos }}</div>
            <div class="text-muted small mt-1">Tipos diferentes</div>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <div class="text-muted small mb-1">Valor total inventario</div>
            <div class="h4 mb-0">
              {{ totalValor | currency:'CLP':'symbol-narrow':'1.0-0' }}
            </div>
            <div class="text-muted small mt-1">Valor en stock</div>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <div class="text-muted small mb-1">Cantidad total</div>
            <div class="h3 mb-0">{{ totalStock }}</div>
            <div class="text-muted small mt-1">Unidades en stock</div>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <div class="text-muted small mb-1">Precio promedio</div>
            <div class="h4 mb-0">
              {{ precioPromedio | currency:'CLP':'symbol-narrow':'1.0-0' }}
            </div>
            <div class="text-muted small mt-1">Por producto</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="row">
      <!-- Gráfico 1: Stock por categoría -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <h5 class="mb-1">Cantidad de Stock por Categoría</h5>
            <p class="text-muted small mb-3">
              Distribución de unidades disponibles por tipo de flor (producto).
            </p>
            <div style="height:260px;">
              <canvas #stockChart></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráfico 2: Valor del inventario por estado -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <h5 class="mb-1">Valor del Inventario por Estado</h5>
            <p class="text-muted small mb-3">
              Distribución del valor total según disponibilidad de stock.
            </p>
            <div style="height:260px;">
              <canvas #estadoChart></canvas>
            </div>
            <p class="text-muted small mt-3 mb-0">
              El tamaño de cada porción representa el porcentaje del valor total
              del inventario.
            </p>
          </div>
        </div>
      </div>
    </div>

  </ng-container>

  <!-- Sin datos -->
  <div
    *ngIf="!cargando && !productos.length && !error"
    class="p-4 text-center text-muted"
  >
    No hay productos registrados para generar el reporte.
  </div>
</div>
